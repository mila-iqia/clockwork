var TimeAgo=function(){var e={locales:{prefix:"",sufix:"ago",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years"},inWords:function(e){var t=Math.floor((new Date-parseInt(e))/1e3),n=this.locales.separator||" ",a=this.locales.prefix+n,l=0,o={year:t/31536e3,month:t/2592e3,day:t/86400,hour:t/3600,minute:t/60},r=this.locales.seconds;for(var s in o){if((l=Math.floor(o[s]))>1){r=this.locales[s+"s"];break}if(1===l){r=this.locales[s];break}}return(a+=(r=r.replace(/%d/i,l))+n+this.locales.sufix).trim()}};return e}();const refresh_endpoint="/jobs/list?want_json=True",id_of_table_to_populate="dashboard_table";var latest_response_contents,latest_filtered_response_contents,page_num;function incrementValue(){var e=parseInt(document.getElementById("page_num").value,10);(e=isNaN(e)?0:e)<10&&(e++,document.getElementById("page_num").value=e),launch_refresh_all_data(query_filter,display_filter)}function decrementValue(){var e=parseInt(document.getElementById("page_num").value,10);(e=isNaN(e)?0:e)>1&&(e--,document.getElementById("page_num").value=e),launch_refresh_all_data(query_filter,display_filter)}function changeValue(e){var t=parseInt(document.getElementById("page_num").value,10);t=e,document.getElementById("page_num").value=t,launch_refresh_all_data(query_filter,display_filter)}function removeAllChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function make_pagination(e,t,n){var a=Math.ceil(n/t);let l=document.getElementById("pagingDiv");if(removeAllChildNodes(l),a>1){if(+e>1){const e=document.createElement("li"),t=document.createElement("a"),n=document.createElement("i");n.className="fa-solid fa-caret-left",l.appendChild(e),e.appendChild(t),t.appendChild(n),t.addEventListener("click",decrementValue)}else{const e=document.createElement("li"),t=document.createElement("span"),n=document.createElement("i");n.className="fa-solid fa-caret-left",l.appendChild(e),e.appendChild(t),t.appendChild(n)}for(var o=1;o<=a;o++)if(o>=1)if(+e!=o){const e=document.createElement("li"),t=document.createElement("a");t.textContent=o,l.appendChild(e),e.appendChild(t),t.addEventListener("click",changeValue.bind(null,o))}else{const e=document.createElement("li"),t=document.createElement("span");t.textContent=o,e.className="current",l.appendChild(e),e.appendChild(t)}if(+e<a){const e=document.createElement("li"),t=document.createElement("a"),n=document.createElement("i");n.className="fa-solid fa-caret-right",l.appendChild(e),e.appendChild(t),t.appendChild(n),t.addEventListener("click",incrementValue)}else{const e=document.createElement("li"),t=document.createElement("span"),n=document.createElement("i");n.className="fa-solid fa-caret-right",l.appendChild(e),e.appendChild(t),t.appendChild(n)}}}function count_jobs(e){let t=document.getElementById("dashboard_completed"),n=document.getElementById("dashboard_running"),a=document.getElementById("dashboard_pending"),l=document.getElementById("dashboard_stalled"),o=0,r=0,s=0,d=0;[].forEach.call(e,(function(e){D_job_slurm=e.slurm,job_state=D_job_slurm.job_state.toLowerCase(),"completed"==job_state&&o++,"running"!=job_state&&"completing"!=job_state||r++,"pending"==job_state&&s++,"timeout"!=job_state&&"out_of_memory"!=job_state&&"failed"!=job_state&&"cancelled"!=job_state||d++})),t.textContent=o,n.textContent=r,a.textContent=s,l.textContent=d}function launch_refresh_all_data(e,t){let n=refresh_endpoint;0!=e.username.localeCompare("all")&&(n=n+"&username="+e.username);const a=new Request(n,{method:"GET",headers:{"Content-Type":"application/json"}});fetch(a).then((e=>{if(200===e.status)return e.json();throw new Error("Something went wrong on api server!")})).then((e=>{latest_response_contents=e,refresh_display(t)})).catch((e=>{console.error(e)}))}function refresh_display(e){page_num=document.getElementById("page_num").value,latest_filtered_response_contents=apply_filter(latest_response_contents.jobs,e),alljobs_filtered=apply_filter(latest_response_contents.jobs,e),total_jobs=latest_response_contents.nbr_total_jobs,nbr_items_per_page=e.num_per_page,nbr_pages=Math.ceil(total_jobs/nbr_items_per_page);var t,n;t=nbr_items_per_page,n=page_num,latest_filtered_response_contents=latest_filtered_response_contents.slice((n-1)*t,n*t),vacate_table(),populate_table(latest_filtered_response_contents);[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map((function(e){return new bootstrap.Tooltip(e)}));count_jobs(alljobs_filtered),make_pagination(page_num,nbr_items_per_page,total_jobs)}function removeAllChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function vacate_table(){document.getElementById("dashboard_table").innerHTML=""}function apply_filter(e,t){return e.filter((e=>t.cluster_name[e.slurm.cluster_name]&&t.job_state[e.slurm.job_state]))}function populate_table(e){let t,n=document.getElementById("dashboard_table"),a=document.createElement("thead"),l=document.createElement("tr");t=document.createElement("th"),t.innerHTML="Cluster",l.appendChild(t),t=document.createElement("th"),t.innerHTML="Job ID",l.appendChild(t),t=document.createElement("th"),t.innerHTML="Job name [:20]",l.appendChild(t),t=document.createElement("th"),t.innerHTML="Job state",l.appendChild(t),t=document.createElement("th"),t.innerHTML="Start time",l.appendChild(t),t=document.createElement("th"),t.innerHTML="End time",l.appendChild(t),t=document.createElement("th"),t.innerHTML="Links",t.setAttribute("data-sortable","false"),l.appendChild(t),t=document.createElement("th"),t.innerHTML="Actions",t.setAttribute("data-sortable","false"),l.appendChild(t),a.appendChild(l),n.appendChild(a);let o=document.createElement("tbody");[].forEach.call(e,(function(e){D_job_slurm=e.slurm,job_state=D_job_slurm.job_state.toLowerCase();let t,n=document.createElement("tr");t=document.createElement("td"),t.innerHTML=D_job_slurm.cluster_name,n.appendChild(t),t=document.createElement("td"),t.innerHTML='<a href="/jobs/one?job_id='+D_job_slurm.job_id+'">'+D_job_slurm.job_id+"</a>",n.appendChild(t),t=document.createElement("td"),t.innerHTML=(D_job_slurm.name?D_job_slurm.name:"").substring(0,20),n.appendChild(t),t=document.createElement("td"),t.className="state";var a=job_state.replace(/_/g," ");t.innerHTML='<span class="status '+job_state+'">'+a+"</span>",n.appendChild(t),t=document.createElement("td"),null==D_job_slurm.start_time?t.innerHTML="":t.innerHTML=TimeAgo.inWords(Date.now()-D_job_slurm.start_time),n.appendChild(t),t=document.createElement("td"),null==D_job_slurm.end_time?t.innerHTML="":t.innerHTML=TimeAgo.inWords(Date.now()-D_job_slurm.start_time),n.appendChild(t),t=document.createElement("td"),t.className="links",t.innerHTML="<a href='' data-bs-toggle='tooltip' data-bs-placement='right' title='Link to somewhere'><i class='fa-solid fa-file'></i></a><a href='' data-bs-toggle='tooltip' data-bs-placement='right' title='Link to another place'><i class='fa-solid fa-link-horizontal'></i></a>",n.appendChild(t),t=document.createElement("td"),t.className="actions",t.innerHTML="<a href='' class='stop' data-bs-toggle='tooltip' data-bs-placement='right' title='Cancel job'><i class='fa-solid fa-xmark'></i></a>",n.appendChild(t),o.appendChild(n)})),n.appendChild(o)}function retrieve_username_from_email(e){if(null!==e){return e.split("@")[0]}return""}