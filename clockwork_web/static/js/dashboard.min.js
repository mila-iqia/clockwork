var TimeAgo=function(){var e={locales:{prefix:"",sufix:"ago",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years"},inWords:function(e){var t=Math.floor((new Date-parseInt(e))/1e3),n=this.locales.separator||" ",a=this.locales.prefix+n,o=0,l={year:t/31536e3,month:t/2592e3,day:t/86400,hour:t/3600,minute:t/60},r=this.locales.seconds;for(var s in l){if((o=Math.floor(l[s]))>1){r=this.locales[s+"s"];break}if(1===o){r=this.locales[s];break}}return(a+=(r=r.replace(/%d/i,o))+n+this.locales.sufix).trim()}};return e}();const refresh_endpoint="/jobs/list?want_json=True",id_of_table_to_populate="dashboard_table";var latest_response_contents,latest_filtered_response_contents;function launch_refresh_all_data(e,t){let n=refresh_endpoint;0!=e.user.localeCompare("all")&&(n=n+"&user="+e.user);const a=new Request(n,{method:"GET",headers:{"Content-Type":"application/json"}});fetch(a).then((e=>{if(200===e.status)return e.json();throw new Error("Something went wrong on api server!")})).then((e=>{latest_response_contents=e,refresh_display(t)})).catch((e=>{console.error(e)}))}function refresh_display(e){latest_filtered_response_contents=apply_filter(latest_response_contents,e),vacate_table(),populate_table(latest_filtered_response_contents),Sortable.init();[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map((function(e){return new bootstrap.Tooltip(e)}));count_jobs(latest_filtered_response_contents)}function removeAllChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function vacate_table(){document.getElementById("dashboard_table").innerHTML=""}function apply_filter(e,t){return e.filter((e=>t.cluster_name[e.slurm.cluster_name]&&t.job_state[e.slurm.job_state]))}function populate_table(e){let t,n=document.getElementById("dashboard_table"),a=document.createElement("thead"),o=document.createElement("tr");t=document.createElement("th"),t.innerHTML="Cluster",o.appendChild(t),t=document.createElement("th"),t.innerHTML="Job ID",o.appendChild(t),t=document.createElement("th"),t.innerHTML="Job name [:20]",o.appendChild(t),t=document.createElement("th"),t.innerHTML="Job state",o.appendChild(t),t=document.createElement("th"),t.innerHTML="Start time",o.appendChild(t),t=document.createElement("th"),t.innerHTML="End time",o.appendChild(t),t=document.createElement("th"),t.innerHTML="Links",t.setAttribute("data-sortable","false"),o.appendChild(t),t=document.createElement("th"),t.innerHTML="Actions",t.setAttribute("data-sortable","false"),o.appendChild(t),a.appendChild(o),n.appendChild(a);let l=document.createElement("tbody");[].forEach.call(e,(function(e){D_job_slurm=e.slurm,job_state=D_job_slurm.job_state.toLowerCase();let t,n=document.createElement("tr");t=document.createElement("td"),t.innerHTML=D_job_slurm.cluster_name,n.appendChild(t),t=document.createElement("td"),t.innerHTML='<a href="/jobs/one?job_id='+D_job_slurm.job_id+'">'+D_job_slurm.job_id+"</a>",n.appendChild(t),t=document.createElement("td"),t.innerHTML=(D_job_slurm.name?D_job_slurm.name:"").substring(0,20),n.appendChild(t),t=document.createElement("td"),t.innerHTML='<span class="status '+job_state+'">'+job_state+"</span>",n.appendChild(t),t=document.createElement("td"),null==D_job_slurm.start_time?t.innerHTML="":t.innerHTML=TimeAgo.inWords(Date.now()-D_job_slurm.start_time),n.appendChild(t),t=document.createElement("td"),null==D_job_slurm.end_time?t.innerHTML="":t.innerHTML=TimeAgo.inWords(Date.now()-D_job_slurm.start_time),n.appendChild(t),t=document.createElement("td"),t.className="links",t.innerHTML="<a href='' data-bs-toggle='tooltip' data-bs-placement='right' title='Link to somewhere'><i class='fa-solid fa-file'></i></a><a href='' data-bs-toggle='tooltip' data-bs-placement='right' title='Link to another place'><i class='fa-solid fa-link-horizontal'></i></a>",n.appendChild(t),t=document.createElement("td"),t.className="actions",t.innerHTML="<a href='' class='stop' data-bs-toggle='tooltip' data-bs-placement='right' title='Cancel job'><i class='fa-solid fa-ban'></i></a>",n.appendChild(t),l.appendChild(n)})),n.appendChild(l)}function count_jobs(e){let t=document.getElementById("dashboard_running"),n=document.getElementById("dashboard_completed"),a=document.getElementById("dashboard_pending"),o=document.getElementById("dashboard_stalled"),l=0,r=0,s=0,i=0;[].forEach.call(e,(function(e){D_job_slurm=e.slurm,job_state=D_job_slurm.job_state.toLowerCase(),"running"!=job_state&&"completing"!=job_state||l++,"completed"==job_state&&r++,"pending"==job_state&&s++,"timeout"!=job_state&&"out_of_memory"!=job_state&&"failed"!=job_state&&"cancelled"!=job_state||i++})),t.textContent=l,n.textContent=r,a.textContent=s,o.textContent=i}function retrieve_username_from_email(e){if(null!==e){return e.split("@")[0]}return""}