{% extends "base.html" %}
{% block title %} {{note_title}} {% endblock %}
{% block head %}
    {{ super() }}
    <style type="text/css">
        {{extra_css}}
    </style>
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/clockwise.css') }}"> -->
    <script>
        {% autoescape false %}
        {{extra_js}}
        {% endautoescape %}

    </script>

{% endblock %}
{% block content %}

    <div class="container">
        <div class="row">
            <div class="col-sm-12" id="changeme">
                <div class="row justify-content-between">
                    <div class="col-8">
                        <div class="title float-start">
                            <i class="fa-solid fa-list"></i>
                            <h1>JOBS</h1>
                        </div>
                        <!-- <a class="btn" onclick="server_refresh()">refresh</a> -->
                    </div>
                    <div class="col-4">
                        <form id="nbr_per_page" method="get">
                            {% set nbr_items_per_page = request.args.get('nbr_items_per_page') %}
                            <label for="nbr_items_per_page">Items per page</label>
                            <select class="form-select" aria-label="Items per page" id="nbr_items_per_page" name="nbr_items_per_page">
                                <option value="25" {{ "selected" if nbr_items_per_page == '25' }}>25</option>
                                <option value="50" {{ "selected" if nbr_items_per_page == '50' }}>50</option>
                                <option value="100" {{ "selected" if nbr_items_per_page == '100' }}>100</option>
                            </select>
                        </form>
                    </div>
                </div>
                <table class="table table-striped table-hover table-responsive" data-sortable id="search_table">
                    <thead>
                        <tr>
                            <th>Cluster</th>
                            <th>User</th>
                            <th>Job ID</th>
                            <th>Job name [:20]</th>
                            <th>Job state</th>
                            <th>Start time</th>
                            <th>End time</th>
                            <th data-sortable="false">Links</th>
                            <th data-sortable="false">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for D_job in LD_jobs %}
                        <tr>
                            <!-- Cluster -->
                            <td>{{D_job['slurm']['cluster_name']}}</td>
                            
                            <!-- User -->
                            <td>{{D_job['cw']['best_guess_for_username']}}</td>

                            <!-- Job ID -->
                            <td>
                                <a href="/jobs/one?cluster_name={{D_job['slurm']['cluster_name']}}&job_id={{D_job['slurm']['job_id']}}">{{D_job['slurm']['job_id']}}</a>
                            </td>

                            <!-- Job name -->
                            <td>{{D_job['slurm'].get("name", "")[0:20]}}</td>

                            <!-- Job state -->
                            <td><span class="status {{D_job['slurm']['job_state']|lower}}">{{D_job['slurm']["job_state"]|title|replace("_", " ")}}</span></td>

                            <!-- Start time -->
                            {% if D_job["slurm"]["start_time"] %}
                                {% set start_time = D_job["slurm"]["start_time"] %}
                                <td data-order='{{start_time}}'><span data-livestamp='{{start_time|int}}'></span></td>
                            {% else %}
                                <td data-order='0'></td>
                            {% endif %}

                            <!-- End time -->
                            {% if D_job["slurm"]["start_time"] %}
                                {% set end_time = D_job["slurm"]["end_time"] %}
                                <td data-order="{{end_time}}"><span data-livestamp='{{end_time|int}}'></span></td>
                            {% else %}
                                <td data-order='0'></td>
                            {% endif %}

                            <!-- Links -->
                            <td class="links">
                               <a href='' data-bs-toggle='tooltip' data-bs-placement='right' title='Link to somewhere'><i class='fa-solid fa-file'></i></a>
                                <a href='' data-bs-toggle='tooltip' data-bs-placement='right' title='Link to another place'><i class='fa-solid fa-link-horizontal'></i></a>
                            </td>

                            <!-- Actions -->
                            <td class="actions">
                                <a href='' class='stop' data-bs-toggle='tooltip' data-bs-placement='right' title='Cancel job'><i class='fa-solid fa-ban'></i></a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock %}
