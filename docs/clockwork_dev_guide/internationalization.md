# Internationalization

Clockwork uses [Flask-Babel](https://pypi.org/project/Flask-Babel/) to handle the different languages of the web interface.

## Translate a string
In order for a string to be translated, it has to be wrapped in the function `gettext`, imported as follows:
```
from flask_babel import gettext
```

The sentences wrapped in `gettext` can be then gathered in translations files, described in the [following section](#generate-translation-files).

In the Clockwork web interface, the original sentences are in English.

## Translation files
### Overview
To handle the translations, Flask-Babel is based on three types of files, presenting the extensions `pot`, `po` and `mo`.

1. First of all, a `.pot` file is generated. It is a template gathering all the translations.
2. Then, `.po` files based on this `.pot` files are generated: one for each language (except for English, as the base sentences can be used). They contain the translations related to their languages.
3. Finally, `.mo` files are generated from the `.po` files. Thus, each language presents one `.mo` file too. The `.mo` file is a compiled `.po` file, and is used by the app.

The following scheme presents an overview of these files generation.

![Translation files generation](../images/translation-files-generation.jpg)

Thus, the translations specific to each language are contained in the `.po` files. They are the ones which will be pushed on the Github repository. This section presents more details about each one of these files.

### `.pot` file
#### Generate
The `.pot` file can be generated by the following command line:
```
pybabel extract -F clockwork_web/babel.cfg -o clockwork_web/static/locales/messages.pot clockwork_web/
```

with:
* `clockwork_web.babel.cfg` the Flask-Babel configuration file. It presents where the sentences to translate have to be searched. It contains the following lines:
  ```
  [python: **.py]
  [jinja2: **/templates/**.html]
  ```
* `clockwork_web/static/locales/messages.pot` the output file. It is the path of the generated `.pot` file
* `clockwork_web/` the folder in which the sentences to translate (the ones wrapped in `gettext`) are searched, using the configuration file.

#### Format
In the `.pot` file, the sentences to translate are presented as follow:
```
#: clockwork_web/browser_routes/clusters.py:56
msgid "This cluster is not known."
msgstr ""

#: clockwork_web/browser_routes/clusters.py:64
msgid "The argument cluster_name is missing."
msgstr ""

#: clockwork_web/templates/settings.html:44
msgid "user settings %(mila_email_username)"
msgstr ""

#: clockwork_web/templates/cluster.html:78
#: clockwork_web/templates/cluster.html:83
msgid "Display all the jobs running on this cluster"
msgstr ""
```

Thus, for each sentence to translate, the path(s) of the file(s) where it is contained is(/are) presented, followed by the English sentence to translate, playing the role of id. Finally, a `msgstr` followed by an empty string is presented. **The `.pot` file is used to generate the `.po` files. It is a template. Thus, the empty string has not to be filled.**

### `.po` files
#### Generate
The `.po` files can be generated from the `.pot` file by the command line:
```
pybabel init -i clockwork_web/static/locales/messages.pot -d clockwork_web/static/locales/ -l fr
```

with:
* `clockwork_web/static/locales/messages.pot` the template translation file as input
* `clockwork_web/static/locales/` the folder where the `.po` files will be create
* `fr` the name of the translation language (French in our case)

This command line creates the file `/locales/fr/LC_MESSAGES/messages.po`

#### Update
If the `.pot` file has been changed (because some sentences have been added for instance), the `.po` files can be updated by the following command:
```
pybabel update -i clockwork_web/static/locales/messages.pot -d clockwork_web/static/locales/
```

with:
* `clockwork_web/static/locales/messages.pot` the template translation file as input
* `clockwork_web/static/locales/` the folder where the `.po` files will be create

#### Format
In the `.po` file, the sentences to translate and their associated translations are presented as follows:
```
#: clockwork_web/browser_routes/clusters.py:56
msgid "This cluster is not known."
msgstr "Le cluster n'a pas été trouvé."

#: clockwork_web/browser_routes/clusters.py:64
msgid "The argument cluster_name is missing."
msgstr "L'argument cluster_name n'a pas été renseigné."

#: clockwork_web/templates/settings.html:44
msgid "user settings %(mila_email_username)"
msgstr "Paramètres de l'utilisateur %(mila_email_username)"

#: clockwork_web/templates/cluster.html:78
#: clockwork_web/templates/cluster.html:83
msgid "Display all the jobs running on this cluster"
msgstr "Afficher tous les jobs roulant sur ce cluster"
```

The format is very similar to the `.pot` file, but the translations are provided.

### `.mo` files
The `.mo` files can be generated from the `.po` files by the following command line:
```
pybabel compile -d clockwork_web/static/locales
```
with:
* `clockwork_web/static/locales` the folder where the subfolders corresponding to the different languages are.
